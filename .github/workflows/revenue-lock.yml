name: Revenue Lock

on: [pull_request]

jobs:
  revenue-lock:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Protect revenue files
        run: |
          protected=(
            "public/ads.txt"
            "src/app/api/stripe"
            "src/lib/stripe"
            "src/components/AdSense.tsx"
            "src/app/components/GoogleAdsPlaceholder.tsx"
          )

          for file in "${protected[@]}"; do
            if git diff --name-only origin/main...HEAD | grep -q "$file"; then
              echo "❌ Revenue-protected file modified: $file"
              exit 1
            fi
          done

          echo "✅ Revenue lock passed"
