name: Revenue Lock

on: [pull_request]

jobs:
  revenue-lock:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Protect revenue files
        run: |
          protected=(
            "public/ads.txt"
            "src/app/api/stripe"
            "src/lib/stripe"
            "src/components/AdSense.tsx"
            "src/app/components/GoogleAdsPlaceholder.tsx"
          )

          violations=()
          for file in "${protected[@]}"; do
            if git diff --name-only origin/main...HEAD | grep -q "$file"; then
              violations+=("$file")
            fi
          done

          if [ ${#violations[@]} -gt 0 ]; then
            echo "❌ Revenue-protected files modified:"
            for v in "${violations[@]}"; do
              echo "   - $v"
            done
            exit 1
          fi

          echo "✅ Revenue lock passed"
