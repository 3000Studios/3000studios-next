name: Revenue Lock Guard

on:
  pull_request:
    branches: [main]

jobs:
  revenue-lock:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Protect ads.txt
        run: |
          git fetch origin main
          if git diff --name-only origin/main...HEAD | grep -q "ads.txt"; then
            echo "❌ ads.txt is protected and cannot be modified"
            exit 1
          fi

      - name: Protect Stripe Environment Usage
        run: |
          if git diff origin/main...HEAD | grep -E "STRIPE_SECRET|STRIPE_3000_SECRET|NEXT_PUBLIC_STRIPE"; then
            echo "❌ Stripe environment variables modified"
            exit 1
          fi

      - name: Protect AdSense CMP Logic
        run: |
          if git diff origin/main...HEAD | grep -E "consent|adsense|cmp|iab"; then
            echo "⚠️ Ad/Consent logic touched — requires manual review"
          fi

      - name: Revenue Lock Passed
        run: echo "✅ Revenue systems intact"
