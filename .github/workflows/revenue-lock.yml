name: Revenue Lock

permissions:
  contents: read

on: [pull_request]

jobs:
  revenue-lock:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Protect revenue files
        run: |
          # Define critical revenue paths
          protected=(
            "public/ads.txt"
            "src/lib/stripe.ts"
            "src/components/AdSense.tsx"
            "src/lib/affiliates.ts"
            "src/app/api/checkout"
          )

          echo "üîç Checking for modifications to revenue-critical files..."

          # Check against main branch
          # git diff --name-only origin/main...HEAD

          violation=false

          for file in "${protected[@]}"; do
            if git diff --name-only origin/main...HEAD | grep -q "$file"; then
              echo "‚ùå Revenue-protected file modified: $file"
              violation=true
            fi
          done

          if [ "$violation" = true ]; then
             echo "üõë REVENUE LOCK: Modifications to revenue systems detected."
             echo "   These files are locked to prevent accidental revenue loss."
             echo "   If this change is intentional, please override this check with approval."
             exit 1
          fi

          echo "‚úÖ Revenue lock passed - No critical monetization files touched."
